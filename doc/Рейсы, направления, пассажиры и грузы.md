# Рейсы, направления, пассажиры и грузы

**Рейс** - это сущность, представляющая маршрут в целом. 
Таблица - `trans.flights` (содержит номер рейса, дату отправления, ID транспортной компании и т.п.).

**Остановка рейса** - это точка маршрута. 
Таблица - `trans.flight_destinations`. Каждая остановка имеет порядковый номер в рамках рейса (поле `order`, нумерация с 0). Поле `date_arrival` - дата прибытия на остановку, `date_departure` - дата отбытия с остановки.

**Направление** - это пара последовательных остановок. 
Отдельной таблицы для направлений нет. При необходимости сослаться на направление нужно использовать его начальную и конечную остановки из  `flight_destinations`.

Например, в рейсе есть 4 остановки (по порядку): Стрежевой, Чкаловское, Раскино, Лугинецкое. Тогда направлений будет 3: 
1) Стрежевой - Чкаловское
2) Чкаловское - Раскино
3) Раскино - Лугинецкое

У самолетных рейсов, как правило, только одно направление.

## Пассажиры

Пассажиры призвязываются к паре остановок рейса. Эти привязки хранятся в таблице `trans.flight_stage_passengers`:
- `from_dest_id`, `to_dest_id` - поля для привязки к направлению (внешние ключи  на таблицу `flight_destinations`)
- `rp_route_id` и `rp_passenger_id` - поля для привязки к факт. заявке (составной внешний ключ на таблицу `route_passengers`)

### Категории пассажиров

Пассажиры на направлении делятся на три категории:
1) **добавленные** - пассажиры, которых НЕ БЫЛО ни на одном из предыдущих направлений рейса
2) **транзитные** - пассажиры, которые БЫЛИ хотя бы на одном из предыдущих направлений рейса
3) **доступные** - пассажиры из заявок...
	- со статусом "В производстве"
    - для такого же вида транспорта, как и текущий рейс
    - с направлениями, начинающимися в том же пункте (point_id), что и текущее направление
   - с датой отправления в заявке, равной дате отправления в текущем направлении (+/- 4 дня)
     - кроме пассажиров, уже привязанных к текущему или любому другому направлению

### Пересадка пассажира

Пассажир удаляется с направлений `n, n+1, n+2...` текущего рейса и добавляется на направления `m, m+1, m+2...(до пунта назначения согласно заявке)` другого или этого же рейса при условии, что направления `n` и `m` начинаются в одном и том же пункте (point_id). 

Зачастую пересадка выполняется в рамках одного и того же рейса, чтобы пассажир не пролетал по "крюку". Например, в рейсе A - B - **C** - D - E - D - **C** - F пассажир может быть пересажен с направления C-D на направление C-F, чтобы не пролетать по "крюку" C-D-E-D-C. В этом случае пассажир будет ожидать вертолет в пункте C. Привязки пассажира к направлениям C-D, D-E, E-D, D-C будут удалены.


## Грузы

Аналогично пассажирам, грузы привязываются к паре остановок рейса. Эти привязки хранятся в таблице `trans.flight_stage_cargo`.

Однако у грузов есть особенность: их можно добавлять по частям. Например, 100 кг груза из заявки можно погрузить на три судна партиями по 45 кг, 20 кг и 35 кг (значения произвольные). Партия груза представлена отдельной сущностью, которой соответствует таблица `trans.cargo_lot`:
- поле `weight` - вес партии
- поле `cargo_id` - привязка к грузу из заявки

Цепочка таблиц для связи груза на направлении с его факт. заявкой: 
`flight_stage_cargo` → `cargo_lot` → `cargo` → `routes` → `order_fact`

### Категории грузов

Категории грузов на направлении аналогичны категориям пассажиров.
